import{L as z,r as o,c}from"./main-BT7iXV3b.js";const O=z("chat",()=>{const i=o([]),t=o([]),s=o({stage:"greeting",collectedData:{age_group:null,region:null,condition:null,season:null,portion_size:null,cost_preference:null,Energy_kcal_per_serving:null,Protein_g_per_serving:null,Fat_g_per_serving:null,Carbohydrates_g_per_serving:null,Fiber_g_per_serving:null,Calcium_mg_per_serving:null,Iron_mg_per_serving:null,Magnesium_mg_per_serving:null,Phosphorus_mg_per_serving:null,Potassium_mg_per_serving:null,Sodium_mg_per_serving:null,Zinc_mg_per_serving:null},pendingQuestion:null}),g=o(!1),d=o(!1),_=c(()=>i.value.length>0),v=c(()=>{const n=s.value.collectedData;return n.age_group!==null&&n.region!==null&&n.condition!==null&&n.season!==null&&n.Energy_kcal_per_serving!==null&&n.Protein_g_per_serving!==null});function r(n){i.value.push({id:Date.now(),text:n.text,type:n.type,timestamp:new Date().toISOString(),data:n.data||null}),a()}function p(n){r({text:n,type:"user"})}function m(n,l=null){r({text:n,type:"bot",data:l})}function f(n){r({text:n,type:"system"})}function h(n){s.value.collectedData={...s.value.collectedData,...n},a()}function y(n){s.value.stage=n,a()}function S(n){s.value.pendingQuestion=n}function D(){i.value=[],a()}function b(){i.value=[],s.value={stage:"greeting",collectedData:{age_group:null,region:null,condition:null,season:null,portion_size:null,cost_preference:null,Energy_kcal_per_serving:null,Protein_g_per_serving:null,Fat_g_per_serving:null,Carbohydrates_g_per_serving:null,Fiber_g_per_serving:null,Calcium_mg_per_serving:null,Iron_mg_per_serving:null,Magnesium_mg_per_serving:null,Phosphorus_mg_per_serving:null,Potassium_mg_per_serving:null,Sodium_mg_per_serving:null,Zinc_mg_per_serving:null},pendingQuestion:null},a()}function a(){try{localStorage.setItem("mzeechakula_chat_messages",JSON.stringify(i.value)),localStorage.setItem("mzeechakula_chat_state",JSON.stringify(s.value))}catch(n){console.error("Error saving chat to localStorage:",n)}}function u(){try{const n=localStorage.getItem("mzeechakula_chat_messages"),l=localStorage.getItem("mzeechakula_chat_state"),e=localStorage.getItem("mzeechakula_chat_history");n&&(i.value=JSON.parse(n)),l&&(s.value=JSON.parse(l)),e&&(t.value=JSON.parse(e))}catch(n){console.error("Error loading chat from localStorage:",n)}}function k(){try{if(i.value.length===0)return;const n={id:Date.now(),messages:[...i.value],collectedData:{...s.value.collectedData},timestamp:new Date().toISOString(),stage:s.value.stage};t.value.unshift(n),t.value.length>20&&(t.value=t.value.slice(0,20)),localStorage.setItem("mzeechakula_chat_history",JSON.stringify(t.value))}catch(n){console.error("Error saving conversation to history:",n)}}function I(){t.value=[],localStorage.removeItem("mzeechakula_chat_history")}function C(n){const l=t.value.find(e=>e.id===n);l&&(i.value=[...l.messages],s.value.collectedData={...l.collectedData},s.value.stage=l.stage,a())}function w(n){const l={age_group:null,region:null,condition:null,season:null,nutrition:{}},e=n.toLowerCase();return e.includes("60")||e.includes("sixty")||e.includes("sixties")?l.age_group=0:e.includes("70")||e.includes("seventy")||e.includes("seventies")?l.age_group=1:(e.includes("80")||e.includes("eighty")||e.includes("eighties")||e.includes("90"))&&(l.age_group=2),e.includes("central")||e.includes("kampala")||e.includes("buganda")?l.region=0:e.includes("western")||e.includes("mbarara")||e.includes("ankole")?l.region=1:e.includes("eastern")||e.includes("mbale")||e.includes("busoga")?l.region=2:(e.includes("northern")||e.includes("gulu")||e.includes("acholi"))&&(l.region=3),e.includes("hypertension")||e.includes("high blood pressure")||e.includes("bp")?l.condition=0:e.includes("diabetes")||e.includes("sugar")?l.condition=1:e.includes("anemia")||e.includes("anaemia")||e.includes("low blood")?l.condition=2:e.includes("osteoporosis")||e.includes("bone")?l.condition=3:e.includes("heart")||e.includes("cardiovascular")?l.condition=4:e.includes("kidney")||e.includes("renal")?l.condition=5:e.includes("arthritis")||e.includes("joint")?l.condition=6:(e.includes("healthy")||e.includes("no condition")||e.includes("none"))&&(l.condition=7),e.includes("dry")||e.includes("hot")?l.season=0:(e.includes("wet")||e.includes("rain")||e.includes("rainy"))&&(l.season=1),l}return u(),{messages:i,conversationHistory:t,conversationState:s,isListening:g,isSpeaking:d,hasMessages:_,isDataComplete:v,addMessage:r,addUserMessage:p,addBotMessage:m,addSystemMessage:f,updateCollectedData:h,setStage:y,setPendingQuestion:S,clearMessages:D,resetConversation:b,parseUserInput:w,saveToLocalStorage:a,loadFromLocalStorage:u,saveConversationToHistory:k,clearHistory:I,loadConversationFromHistory:C}});export{O as u};
